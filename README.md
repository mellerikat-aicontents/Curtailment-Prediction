# Curtailment-Prediction
=======
# 📖Solution

## 🔋🔌Curtailment Prediction(CP)🪫


## What is Curtailment?
전력시장에는 수요와 공급이 존재합니다. 수요를 충족시키기 위해 공급자는 화력, 원자력과 같은 전통적인 에너지원과 태양광, 풍력, 수력, 지열 등 신재생에너지를 활용해 전기를 생산하고 이를 전력망에 전달합니다. 전력시장을 운영하는 전력거래소(KPX)는 전력을 필요로 하는 수요자에게 적시에 에너지를 공급하며, 전력 계통의 안정성을 유지하기 위해 실시간으로 시장을 관리합니다. 또한 발전사업자와 판매사업자 간의 공정하고 투명한 거래를 보장하며, 전국의 발전소와 전력망을 24시간 365일 감시하여 정전이나 전압 강하를 방지합니다. 이를 위해 전력거래소는 급전지시를 내릴 수 있습니다.
급전지시는 전력 공급과 수요의 균형을 맞추기 위해 발전소에 내리는 명령으로, 즉각적으로 출력량의 증감을 지시합니다. 이 중 공급 과잉 상황에서는 출력을 줄이는 급전지시, 즉 출력제어(curtailment)가 내려집니다. 출력제어는 전력망의 안정성을 유지하고, 설비를 보호하며, 에너지 낭비를 방지하기 위한 필수적인 조치입니다.

출력제어가 일어나야 하는 이유는 이러합니다.

- 전력망은 전력의 공급과 수요가 실시간으로 일치해야만 안정적으로 운영됩니다. 전력망은 특정 주파수를 유지해야 하는데, 발전량이 수요를 초과하면 주파수가 상승하고 수요량이 공급을 초과하면 주파수가 낮아져 문제가 생깁니다.
- 또한 공급 과잉으로 인해 송전망에 과부하가 발생할 위험도 있습니다.
- 전력 수요는 시간대, 계절, 기상 조건에 따라 크게 변동하고, 특히 신재생에너지의 간헐성은 전력 공급 변동성을 높이는 요인이므로 출력제어가 필수적입니다.
- 공급 과잉으로 전력을 강제로 버려야 하는 상황에서 발전량을 줄임으로써 불필요한 에너지 낭비를 방지하고 효율적으로 운영합니다.

따라서 출력제어는 꼭 필요한 조치입니다.



## Curtailment Problems
출력제어가 일어나면 발전사업자들은 발전량을 즉각적으로 줄이거나 설비를 일시적으로 정지해야 합니다. 이는 발전소 운영 계획을 변경하고, 설비를 조정하거나 중단된 설비를 재가동하기 위한 추가적인 관리를 요구합니다. 특히 신재생에너지 발전사업자는 발전량 예측 데이터를 업데이트하고 출력제어 이력을 기록해야 하는 불편함이 있습니다.

출력제어로 인해 **발전사업자들**은 다음과 같은 피해를 입습니다:
1. 계획된 발전량이 줄어들면서 판매 수익이 줄어듭니다. 출력제어가 잦은 지역에서는 이러한 손실이 누적되어 경제적 부담이 더 커집니다.
2. 발전 설비의 가동이 중단과 재가동을 반복하면서 설비의 수명이 단축되거나 유지보수 비용이 증가할 수 있습니다.
3. 출력제어로 인해 전력 판매 기회를 상실하면서 재생에너지 설비에 대한 투자 회수가 어려워집니다.

**전력거래소** 역시 출력제어로 인해 여러 문제에 직면합니다:
1. 잦은 출력제어는 전력 수급 및 계통 운영 예측 능력에 대한 신뢰를 저하시킬 수 있습니다.
2. 출력제어가 빈번할수록 재생에너지 활용률이 저하되며, 국가의 탄소중립 목표 달성에 부정적인 영향을 미칩니다.
3. 출력제어 상황이 늘어나면서 실시간 계통 운영의 복잡성이 증가하며, 전력망 안정성을 유지하기 위한 조정 업무가 어려워집니다.
4. 투자 회수 어려움으로 인해 신규 투자의 유인이 감소하게 됩니다. 이러한 문제는 특히 재생에너지 확대를 목표로 하는 정책에 부정적인 영향을 미칠 수 있습니다.

따라서 전력거래소는 출력제어를 최소화하려하지만, 공급 변동성(특히 신재생에너지)에 의해 출력제어를 내립니다. 발전사업자는 이런 출력제어를 예측하고 대응하려 합니다.



## What is Curtailment Prediction?
출력제어량을 예측하는 것은 전력시장에서 공급사업자에게 중요한 과제입니다. 수익 극대화와 발전 설비 보호를 위해 출력제어 발생 여부와 제어량을 예측하는 것이 필요합니다. 따라서 에너지원 별 공급량과 수요량을 feature로 사용해 예측하는 Curtailment Prediction 모델을 생성했습니다.


## Where is Curtailment Prediction most necessary?
제주도는 신재생에너지 보급 확대에 따라 전력 공급이 수요를 초과하는 상황이 빈번하게 발생해, 전력망의 안정성을 유지하기 위해 발전기의 출력을 제한하는 출력제어가 자주 시행됐습니다. 설비용량의 40%, 발전량의 19%를 재생에너지가 담당하고 있어 재생에너지가 이미 주력 자원에 해당합니다. 봄, 가을철 수요는 낮고 재생에너지 발전은 높아 다수에 걸쳐 출력제어가 시행됐습니다.
(제어 횟수(풍/태): '15년(3회/0회) --> '21년(64회/1회) --> '22년(104회/28회))
신재생에너지 발전소가 지속적으로 늘어난 제주도에서 이 예측이 가장 필수적이었으나, 육지에서 신재생에너지 발전소가 늘어날 전망으로 육지 또한 공급 불안정성이 커지고 있습니다. 따라서 화력발전을 줄이고 신재생에너지를 늘리려는 모든 지역에 이 예측이 필수적입니다.


## Key features and benefits
**주요 요소**
- 에너지원 공급량, 수요량, 출력제어량

**이점**
- 발전사업자의 경제적 손실 최소화
- 전력망 안정성 강화 및 운영 효율성 증대
- 재생에너지 활용률 극대화로 탄소중립 목표 지원



***
# 💡Features
## Pipeline
AI Contents의 pipeline은 기능 단위인 asset의 조합으로 이루어져 있습니다. Curtailment Prediction은 2가지 asset의 조합으로 pipeline이 구성되어 있습니다.

**Train pipeline**
```
Train
```
**Inference pipeline**
```
Inference
```


## Assets
각 단계는 asset으로 구분됩니다.

**Train asset**
XGBoost를 활용한 Train Asset은 데이터를 학습하고 최적의 하이퍼파라미터를 탐색하여 예측 모델을 생성하는 과정입니다. 먼저, 데이터는 결측값 처리, 범주형 변수 인코딩, 정규화 등의 작업이 끝난 상태의 데이터를 사용합니다. 이후, 실험계획서에 미리 정의된 설정에 따라 데이터를 그룹별 또는 컬럼별로 나누어 처리합니다. 예를 들어, 에너지 공급원의 종류 별 예측오차값을 지정한 뒤 해당 컬럼별로 feature의 오차율에 따른 발전제한량을 예측할 수 있습니다. 각 데이터 그룹에 대해 XGBoost 모델 인스턴스를 생성하며, Bayesian Optimization 또는 Grid Search를 활용해 학습 속도(learning rate), 트리의 깊이(max depth), 가중치 감쇠(lambda) 등 하이퍼파라미터를 최적화합니다. 학습 과정에서 조기 종료(Early Stopping) 기능을 적용해 과적합을 방지하고 학습 시간을 줄입니다. 학습이 완료되면 모델의 성능을 평가하고 결과를 저장합니다. 모델은 MSE, MAE, R^2 등 지도학습 기반의 성능 지표를 최대화하는 방향으로 학습을 진행하며, 이 과정에서 모델의 성능 비교 결과와 학습 과정에서 생성된 메트릭은 CSV 형식으로 저장됩니다.

**Inference asset**
Inference Asset에서는 학습된 XGBoost 모델을 활용하여 새로운 데이터에 대한 예측을 수행하고 결과를 저장합니다. 먼저, 데이터는 학습 단계와 동일한 방식으로 그룹과 컬럼별로 나누어 처리됩니다. 나누어진 데이터 그룹마다 이전 학습 단계에서 저장된 최적의 XGBoost 모델을 로드하여 예측을 수행합니다. 예측 결과는 CSV 파일로 저장되며, MSE, MAE, R^2 등 평가 지표가 함께 기록됩니다. 또한, 모델 성능 비교 플롯과 운영에 필요한 요약 파일인 inference_summary.yaml도 함께 생성됩니다.


## Experimental_plan.yaml
내가 갖고 있는 데이터에 AI Contents를 적용하려면 데이터에 대한 정보와 사용할 Contents 기능들을 experimental_plan.yaml 파일에 기입해야 합니다. AI Contents를 solution 폴더에 설치하면 solution 폴더 아래에 contents 마다 기본으로 작성되어있는 experimental_plan.yaml 파일을 확인할 수 있습니다. 이 yaml 파일에 '데이터 정보'를 입력하고 asset마다 제공하는 'user arugments'를 수정/추가하여 ALO를 실행하면, 원하는 세팅으로 데이터 분석 모델을 생성할 수 있습니다.

**experimental_plan.yaml 구조**
experimental_plan.yaml에는 ALO를 구동하는데 필요한 다양한 setting값이 작성되어 있습니다. 이 setting값 중 '데이터 경로'와 'user arguments'부분을 수정하면 AI Contents를 바로 사용할 수 있습니다.

**데이터 경로 입력(external_path)**
external_path의 parameter는 불러올 파일의 경로나 저장할 파일의 경로를 지정할 때 사용합니다. save_train_artifacts_path와 save_inference_artifacts_path는 입력하지 않으면 default 경로인 train_artifacts, inference_artifacts 폴더에 모델링 산출물이 저장됩니다.

```
external_path:
    - load_train_data_path: ./solution/sample_data/train
    - load_inference_data_path: ./solution/sample_data/inference
    - save_train_artifacts_path:
    - save_inference_artifacts_path:
    - load_model_path:
```


***
# 📂Input and Artifacts
## 데이터 준비
**학습 데이터 준비**
1. XGBoost를 활용한 모델 학습을 위해, 분석에 필요한 포인트들이 컬럼 형태로 정리된 CSV 파일이 필요합니다.
    {발전제한량, HVDC, 풍력, 태양광, 중유, 경유, 바이오중유, demand}
2. 모든 CSV 파일에는 각 행을 식별할 수 있는 time 컬럼이 필수적으로 포함되어야 합니다.
3. 목표 변수를 포함한 label 컬럼은 선택 사항이며, 지도학습을 수행하려면 반드시 제공되어야 합니다.
4. 레이블이 제공되는 경우, 예측하고자 하는 X 컬럼들과 함께 모든 행에 동일하게 정의되어야 합니다.
5. 데이터를 그룹별로 묶어 학습하고자 하는 경우에는 그룹화를 위한 기준 컬럼이 CSV 파일에 포함되어야 합니다.

**학습 데이터셋 예시**
|기준일|hour|발전제한량|HVDC|풍력|태양광|중유|경유|바이오중유|demand|
|-----|----|--------|----|----|-----|---|---|---------|------|
|2022-09-06|12|82.5|57.6|181.55|50.05|0|0|182.38|789.433|
|2022-09-07|12|20.2|41.059||111.64|150.98|23.21|0|135.44|608.551|
|2022-09-08|12|0|39.204|4.82|237.36|0|0|136.81|580.33|
|2022-09-09|12|6.5|42.275|28.26|221|0|0|141.82|613.47|


**Input data directory 구조 예시**
ALO를 사용하기 위해서는 train과 inference 파일이 분리되어야 합니다. 아래와 같이 학습에 사용할 데이터와 추론에 사용할 데이터를 구분해주세요.
하나의 폴더 아래 있는 모든 파일을 input asset에서 취합해 하나의 dataframe으로 만든 후 모델링에 사용됩니다. (경로 밑 하위 폴더 안에 있는 파일도 합쳐집니다.)
하나의 폴더 안에 있는 데이터의 컬럼은 모두 동일해야 합니다.
```
./{train_folder}/
    └ train_data1.csv
    └ train_data2.csv
    └ train_data3.csv
./{inference_folder}/
    └ inference_data1.csv
    └ inference_data2.csv
    └ inference_data3.csv

```

## 데이터 요구사항
**필수 요구사항**
|index|item|spec.|
|-----|----|-----|
|1|x컬럼의 개수|1개 이상|
|2|데이터 타입|float|
|3|출력제어량 컬럼|1개|
|4|에너지공급원 종류|1개 이상|




## 산출물
**Train pipeline**
```
./alo/train_artifacts/
    └ models/train/
        └ best_model.joblib
    └ log
        └ experimental_history.json
        └ pipeline.log
        └ process.log
```
**Inference pipeline**
```
 ./alo/inference_artifacts/
    └ output/
        └ output.csv
    └ score/
        └ inference_summary.yaml
    └ log
        └ experimental_history.json
        └ pipeline.log
        └ process.log

```
